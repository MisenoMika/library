# War Thunder AIR


## 1. 操作说明
### 1.1 移动（WASD）
- `w`：向上移动
- `s`：向下移动
- `a`：向左移动
- `d`：向右移动

### 1.2 攻击
- `↑`：发射 **导弹 Missile**（玩家导弹 AI=2，会自动追踪敌人；不追 Bomber）
- `↓`：发射 **炮弹 Shell**（玩家炮弹 AI=2，直线飞行）
- `←`：触发“侧向连发/散射”模式（根据当前朝向决定侧射方向）
- `→`：触发“侧向连发/散射”模式（同上）



### 1.3 退出
- `q` / `Q`：直接退出游戏循环（Game::update 中处理）

### 1.4 死亡后重开
Game Over 界面：
- `Y`：重新开始
- `N` / `Q`：退出

---

## 2. 资源与道具
### 2.1 金币 Coins
- 击毁敌人会掉金币
- 当金币 `>= 500` 时，玩家会**自动升级**一次，同时游戏**进入下一关**

### 2.2 道具（Item）
地图会周期性生成两类拾取物，玩家靠近（距离 ≤ 2）自动拾取：
- **MedicalPack `[+]`**：+100 生命
- **WeaponPack `[W]`**：+50 炮弹、+10 导弹

---

## 3. EnemyShip

### 3.1 GunBoat（小艇）
- 血量：20
- 特点：移动较随机；与玩家在同一行/列时会直线开火（Shell）
- 击毁奖励：+10 Coins

### 3.2 Destroyer（驱逐舰）
- 血量：40
- 特点：更积极追踪玩家；会发射炮弹（对齐时）并周期性发射鱼雷（Torpedo）
- 击毁奖励：+30 Coins

### 3.3 Cruiser（巡洋舰）
- 血量：90
- 特点：水平移动，会定时四向开火（上下左右 Shell），并周期性发射导弹（Missile，AI=1 追玩家）
- 击毁奖励：+50 Coins

### 3.4 Bomber（轰炸机/空袭单位）
- 血量：**99999（Be designed as an unkillable unit）**
- 特点：从上方区域横向巡航；会投放鱼雷（Torpedo，目标随机 Y）并周期性散射三发炮弹（Shell）


---
## 4.武器
- Shell
- Torpedo
- Missile

## 5. 升级与成长（玩家）
玩家升级触发条件：
- `coins >= 500` 时自动升级一次

升级效果（`PlayerShip::levelUp()`）：
- 回复生命： +200
- 最大生命（maxHealth）：每 **2 级** +200
- 炮弹：+100
- 导弹：+10
- 经过一定时间会自动恢复子弹和血量
- Level 2:解锁散射侧弦炮（随等级up，发出散射炮弹概率up）
- Level 4:解锁散射前炮
---

## 6. How enemies get more powerful as Level ↑↑
主要体现在**更多敌人**与**更智能的导弹**


### 6.1More Enemy

- **GunBoat 最大数量**
  - `maxGunBoatCount = level + 2`

- **Bomber 最大数量**
  - `maxBomberCount = (level + 1) / 3 + 1`
  - 大约每 3 级增加 1 架

- **Destroyer 最大数量**
  - `maxDestroyerCount = level + 1`

- **Cruiser 最大数量**
  - `maxCruiserCount = (level / 2) + 1`
  - 大约每 2 级增加 1 艘

- **MedicalPack / WeaponPack 最大数量**
  - `maxMedicalPackCount = 2 + (level / 3)`
  - `maxWeaponPackCount  = 2 + (level / 3)`
  - 等级越高，道具“上限”也略提高（但仍受生成周期限制）

这意味着：**玩家每升一级，战场能同时存在的敌人总体规模会变大**，并且中后期更容易出现 Destroyer / Cruiser 等更强单位的组合压力。

### 6.2 敌人的“命中/追踪难度”随 Level 变化（导弹 AI）
敌方导弹（`Missile`，AI=1）追踪玩家时有一个“保持旧方向”的概率：
```cpp
if(rand() % 100 < (85 - 5*game->getLevel()) && (oldDx != 0 || oldDy != 0)) {
    dx = oldDx;
    dy = oldDy;
}
```
含义（直观解释）：
- `level` 越高，`(85 - 5*level)` 越低
- 这个分支触发概率降低 → 导弹越不“犹豫”，越倾向于**根据玩家当前位置更新方向**
- 所以在更高等级下，敌方导弹总体上会表现得更“聪明/更追人”（更难躲）

> 注意：当等级足够高时该值可能变为负数，意味着这个“保持旧方向”的分支几乎不会触发，导弹将更频繁修正方向。



---
## 7. 自定义地图（Custom Map）

### 7.1 如何加载地图
程序启动时支持传入一个地图文件路径（见 `main.cpp`）：

```bash
# Linux / MSYS2
./game ubuntu_map_Version4.txt

# Windows cmd（示例）
game.exe windows11_map_Version4.txt
```

若 **不传参数**，游戏将使用“随机生成障碍物”的模式：
- 在 `Game::update()` 中，当 `delaytime == 1 && mapfile.empty()` 时，会随机生成若干障碍物。

若 **传入地图文件**，构造 `Game` 时会自动调用：
- `Game::loadMap(mapfile);`

---

### 7.2 地图文件格式
地图文件是一个纯文本 `.txt` 文件，按“字符画”的方式描述障碍物与玩家出生点：

- 每一行表示地图的一行（y 方向）
- 每个字符表示一个格子（x 方向）
- 地图只会读取前 `winH` 行、每行只读取前 `winW` 列  
  （即超出游戏战场尺寸的部分会被忽略）

> 注意：由于游戏 UI 预留了顶部区域，`loadMap()` 会把地图的 y 坐标整体下移 `+5` 格：
> - 文件中的第 0 行，会放在游戏中的 y=5
> - 文件中的第 1 行，会放在游戏中的 y=6
> - 以此类推  
> 这也是你地图文件里 `P`（玩家）通常会写在“靠下”的原因。

---

### 7.3 支持的地图符号（Game::loadMap）


#### 7.3.1 基础障碍物（默认颜色）
- `#`：放置障碍物，符号为 `#`（默认白色）

实现：
- `addObstacle(x, y+5, 3, "#");`

#### 7.3.2 彩色障碍物（带颜色编码）
- `B`：蓝色（`:3`）
- `C`：青色（`:5`）

- 以下字符（Ubuntu 橙色/黄色，`:1`）：
  `o s + - / . : ` y d m h`

- 以下字符（绿色，`:4`）：
  `O @`

- `G`：绿色（`:2`）

- `M`：洋红色（`:6`）

- `W`：白色（`:0`）

#### 7.3.3 玩家出生点
- `P`：设置玩家出生点（不会生成障碍物）
  - `playership->setX(x);`
  - `playership->setY(y+5);`

---

### 7.4 地图制作建议
1. **确保有一个 `P`**，否则玩家会使用默认出生点（winW/2, winH/2），可能卡在障碍物里。
2. 地图文件的有效宽高取决于 `winW` / `winH`：
   - `winW = LENGTH - 20`
   - `winH = HEIGHT`
3. 顶部 5 行会被保留（给海线与 Bomber 区域），地图从 y=5 开始绘制。

---

### 7.5 Windows / Linux 显示差异提示
不同终端/字体对字符宽度的处理不同，复杂字符画在 Windows 终端可能出现错位：
- 建议使用等宽字体（Consolas / Cascadia Mono）
- 调大终端窗口宽度，确保列数足够覆盖 `LENGTH`
- 若要完全一致显示，建议把边框绘制逻辑改为基于 `getmaxyx()` 的自适应布局



